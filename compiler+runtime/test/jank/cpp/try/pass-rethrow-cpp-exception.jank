; throw_runtime_error4 is named with a "4" suffix because there is already throw_runtime_error,
; throw_runtime_error2, and throw_runtime_error3 defined in other files and different files are
; not run independently.
(cpp/raw "void throw_runtime_error4() { throw std::runtime_error(\"inner error\"); }")
(cpp/raw "void throw_current() { throw; }")

(let [a (atom [])]
  (try
    (try
      (cpp/throw_runtime_error4)
      (catch cpp/std.runtime_error e
        (swap! a conj :caught-inner)
        (cpp/throw_current)))
    ;; Rethrow using helper function
    (catch cpp/std.runtime_error e
      (swap! a conj :caught-outer)))

  (assert (= [:caught-inner :caught-outer] @a) (pr-str @a)))

:success
